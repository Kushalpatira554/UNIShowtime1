{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 mt-16">
    <div class="max-w-md w-full space-y-8 p-10 rounded-xl shadow-2xl relative overflow-hidden" style="background: linear-gradient(135deg, rgba(20, 30, 40, 0.9), rgba(30, 40, 50, 0.9)); border: 1px solid rgba(148, 180, 193, 0.3); backdrop-filter: blur(10px);">
        
        <!-- Decorative elements for techy look -->
        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-transparent to-#94B4C1 opacity-10 rounded-bl-full"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-transparent to-#ECEFCA opacity-10 rounded-tr-full"></div>
        <div class="relative">
            <div class="text-center">
                <h2 class="mt-6 text-3xl font-extrabold text-#F1F6F9">Set New Password</h2>
                <p class="mt-2 text-center text-sm text-#94B4C1">Please enter your new password twice to verify.</p>
            </div>
        </div>
        <form class="mt-8 space-y-6" method="POST">
            {% csrf_token %}
            <div class="rounded-md shadow-sm space-y-6">
                <div class="form-group relative transition-all duration-300 hover:translate-x-1">
                    <div class="floating-label-container">
                        <input id="new_password1" name="new_password1" type="password" required 
                            class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-#547792/50 placeholder-transparent text-gray-300 focus:outline-none focus:ring-2 focus:ring-#94B4C1 focus:border-transparent focus:z-10 sm:text-sm bg-gray-800/50 backdrop-filter backdrop-blur-sm transition-all duration-300" 
                            placeholder="Enter your new password">
                        <label for="new_password1" class="floating-label text-sm font-medium text-#94B4C1">New Password</label>
                        <div class="ripple-container"></div>
                    </div>
                    <!-- Password strength indicator will be added by JS -->
                    <div class="password-strength-meter mt-1 hidden">
                        <div class="strength-bar"></div>
                    </div>
                </div>
                
                <div class="form-group relative transition-all duration-300 hover:translate-x-1">
                    <div class="floating-label-container">
                        <input id="new_password2" name="new_password2" type="password" required 
                            class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-#547792/50 placeholder-transparent text-gray-300 focus:outline-none focus:ring-2 focus:ring-#94B4C1 focus:border-transparent focus:z-10 sm:text-sm bg-gray-800/50 backdrop-filter backdrop-blur-sm transition-all duration-300" 
                            placeholder="Confirm your new password">
                        <label for="new_password2" class="floating-label text-sm font-medium text-#94B4C1">Confirm New Password</label>
                        <div class="ripple-container"></div>
                    </div>
                </div>
            </div>

            {% if form.errors %}
            <div class="rounded-md bg-red-700/70 p-4 border border-red-500/50 backdrop-blur-sm">
                {% for field in form %}
                    {% for error in field.errors %}
                    <p class="text-sm text-white">{{ error }}</p>
                    {% endfor %}
                {% endfor %}
            </div>
            {% endif %}

            <div>
                <button id="reset-password-button" type="submit" class="reset-btn group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-#F1F6F9 bg-#547792 hover:bg-#94B4C1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-#94B4C1 transition-all duration-300 shadow-lg hover:shadow-#94B4C1/20 overflow-hidden">
                    <span class="relative z-10">Reset Password</span>
                    <span class="btn-bg-animation"></span>
                </button>
            </div>
            
            <script>
                // Form submission animation
                document.querySelector('form').addEventListener('submit', function(e) {
                    const button = document.getElementById('reset-password-button');
                    if (!button.classList.contains('loading')) {
                        button.classList.add('loading');
                        button.innerHTML = '<span class="relative z-10">Processing...</span><span class="btn-bg-animation active"></span>';
                    }
                });
                
                // Password strength indicator
                const password1 = document.getElementById('new_password1');
                const strengthMeter = document.querySelector('.password-strength-meter');
                const strengthBar = document.querySelector('.strength-bar');
                
                if (password1 && strengthMeter && strengthBar) {
                    strengthMeter.classList.remove('hidden');
                    
                    password1.addEventListener('input', function() {
                        const val = password1.value;
                        const result = calculatePasswordStrength(val);
                        
                        // Update the strength bar
                        strengthBar.style.width = result.score + '%';
                        strengthBar.className = 'strength-bar ' + result.class;
                    });
                }
                
                // Add ripple effect to password inputs
                const passwordInputs = document.querySelectorAll('input[type="password"]');
                const rippleContainers = document.querySelectorAll('.ripple-container');
                
                passwordInputs.forEach((input, index) => {
                    input.addEventListener('focus', function(e) {
                        if (rippleContainers[index]) {
                            // Create ripple effect
                            const ripple = document.createElement('span');
                            ripple.classList.add('ripple');
                            rippleContainers[index].appendChild(ripple);
                            
                            // Set position and animate
                            setTimeout(() => {
                                ripple.style.opacity = '0';
                                ripple.style.transform = 'scale(2)';
                                
                                // Remove after animation
                                setTimeout(() => {
                                    rippleContainers[index].removeChild(ripple);
                                }, 600);
                            }, 50);
                        }
                    });
                });
                
                // Calculate password strength
                function calculatePasswordStrength(password) {
                    let score = 0;
                    let strengthClass = '';
                    
                    if (!password) {
                        return { score: 0, class: 'strength-weak' };
                    }
                    
                    // Length check
                    if (password.length > 8) score += 20;
                    else if (password.length > 5) score += 10;
                    
                    // Complexity checks
                    if (/[A-Z]/.test(password)) score += 20; // Has uppercase
                    if (/[a-z]/.test(password)) score += 15; // Has lowercase
                    if (/[0-9]/.test(password)) score += 20; // Has number
                    if (/[^A-Za-z0-9]/.test(password)) score += 25; // Has special char
                    
                    // Determine strength class
                    if (score >= 80) strengthClass = 'strength-strong';
                    else if (score >= 50) strengthClass = 'strength-medium';
                    else strengthClass = 'strength-weak';
                    
                    return { score, class: strengthClass };
                }
            </script>
        </form>
    </div>
</div>
{% endblock %}